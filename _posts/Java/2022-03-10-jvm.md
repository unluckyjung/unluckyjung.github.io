---
title: JVM
date: 2022-03-10-22:06
categories:
- Java

tags:
- Java
- JVM

---

### JVM ì´ë€?
> Java Virtual Machine

---

## Goal
- JVMì˜ ê°œë…ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ë‹ˆë‹¤.
- JVMì˜ ë‚´ë¶€ëŠ” ì–´ë–»ê²Œ ì´ë£¨ì–´ì ¸ìˆëŠ”ì§€ ì•Œì•„ë´…ë‹ˆë‹¤.
- Java7ê³¼ Java8ì—ì„œ JVMì— ì–´ë–¤ ë³€í™”ê°€ ìˆì—ˆëŠ”ì§€ ê°„ëµí•˜ê²Œ ì•Œì•„ë´…ë‹ˆë‹¤.

---

## What
> JVMì´ë€ ìë°”í”„ë¡œê·¸ë¨ì´ ì–´ëŠ ê¸°ê¸°ë‚˜ ìš´ì˜ì²´ì œì—ì„œë„ ì‹¤í–‰ë  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë¨¸ì‹ ì„ ì´ì•¼ê¸°í•©ë‹ˆë‹¤.
    
- JVM ì€ JAVAì™€ OSì‚¬ì´ì—ì„œ `ì¤‘ê°œì` ì—­í• ì„ ìˆ˜í–‰í•´, OSì— êµ¬ì• ë°›ì§€ ì•Šê³  ìë°” ì½”ë“œë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œí•´ì¤ë‹ˆë‹¤. 
- ë˜í•œ `ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬`í•˜ê³ , `GC`ë¥¼ ìˆ˜í–‰í•´ì¤ë‹ˆë‹¤.

    
## ìë°” í”„ë¡œê·¸ë¨ ì‹¤í–‰ê³¼ì •
    
![image](https://user-images.githubusercontent.com/43930419/154238342-61b14731-c9d5-4f1e-9932-d736fb274c6c.png)
    
1. JVMì€ OSë¡œë¶€í„° í”„ë¡œê·¸ë¨ì´ í•„ìš”ë¡œ í•˜ëŠ” ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹ ë°›ìŠµë‹ˆë‹¤.
2. ìë°”ì»´íŒŒì¼ëŸ¬ì¸ javacê°€ ìë°” ì½”ë“œë¥¼ ì½ì–´ë“œë ¤ ë°”ì´íŠ¸ì½”ë“œ(class)ë¡œ ë³€í™˜ì‹œí‚µë‹ˆë‹¤.
3. í´ë˜ìŠ¤ ë¡œë”ë¥¼ í†µí•´ classíŒŒì¼ë“¤ì„ JVMìœ¼ë¡œ Loading í•©ë‹ˆë‹¤.
4. Loadingëœ class íŒŒì¼ë“¤ì€ Execution ì—”ì§„ì„ í†µí•´ í•´ì„ì´ ë©ë‹ˆë‹¤.
5. í•´ì„ëœ ë°”ì´íŠ¸ ì½”ë“œë“¤ì€ Runtime Data Areasì— ë°°ì¹˜ë˜ì–´ ì‹¤ì œ ìˆ˜í–‰ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
    
```java
ì»´íŒŒì¼ëŸ¬ javacê°€ ìë°”ì†ŒìŠ¤ì½”ë“œë¥¼ ì½ê³  ìë°” ë°”ì´íŠ¸ ì½”ë“œë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
ë°”ì´íŠ¸ ì½”ë“œë“¤ì„ í´ë˜ìŠ¤ ë¡œë”ë¥¼ í†µí•´ JVM ë©”ëª¨ë¦¬ ì˜ì—­ìœ¼ë¡œ ë¡œë”©í•©ë‹ˆë‹¤.
ë¡œë”©ëœ íŒŒì¼ë“¤ì€ ì—”ì§„ì„ í†µí•´ í•´ì„ë˜ê³  ìˆ˜í–‰ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
```
    
## ğŸ“ŒÂ JVM êµ¬ì„±
    
## 1. Class Loader
> JVM ë‚´ë¶€ë¡œ í´ë˜ìŠ¤ íŒŒì¼ì„ ë¡œë“œí•˜ëŠ” ëª¨ë“ˆì„ ë§í•©ë‹ˆë‹¤.

- ëŸ°íƒ€ì„ì‹œì— í´ë˜ìŠ¤ë¥¼ ì ì¬í•˜ê³ , ì˜¬ë°”ë¥¸ ë°”ì´íŠ¸ì½”ë“œë¡œ ì‘ì„±ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.
    
## 2. Execution Engine(ì‹¤í–‰ ì—”ì§„)
> í´ë˜ìŠ¤(.class)ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.  

- JVMë‚´ë¶€ì— ë°°ì¹˜ëœ ë°”ì´íŠ¸ ì½”ë“œë“¤ì„ ì‹¤í–‰ í•©ë‹ˆë‹¤.
- `.class` í˜•íƒœì˜ ë°”ì´íŠ¸ ì½”ë“œë“¤ì€ ì‚¬ëŒì´ ì½ê¸°ì—ëŠ” í¸í•˜ë‚˜, ê¸°ê³„ê°€ ì½ê¸°ëŠ” ë¶ˆí¸í•œ í˜•íƒœì´ë¯€ë¡œ ê¸°ê³„ì–´ë¡œ ë³€ê²½í•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤.
- **ì¸í„°í”„ë¦¬í„°, JIT, GC**ê°€ ì´ì•ˆì— ì†í•©ë‹ˆë‹¤.

    
### 2.1 Interpreter(ì¸í„°í”„ë¦¬í„°)
> ìë°” ë°”ì´íŠ¸ ì½”ë“œë¥¼ ëª…ë ¹ì–´ ë‹¨ìœ„ë¡œ ì½ì–´ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
- ìë°”ì˜ ê²½ìš° ì¸í„°í”„ë¦¬í„° + ì»´íŒŒì¼ëŸ¬ê°€ í˜¼í•©ëœ ì–¸ì–´ì…ë‹ˆë‹¤.
- í•˜ì§€ë§Œ í•œì¤„ì”© ì½ê¸°ë•Œë¬¸ì— ì—„ì²­ ëŠë¦¬ë‹¤ë¼ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.
    
### 2.2 JIT(Just In Time)
> ì¸í„°í”„ë¦¬í„°ì˜ ëŠë¦°ì†ë„ë¼ëŠ” ë‹¨ì ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ì¶”ê°€ëœ ì¼ì¢…ì˜ ì»´íŒŒì¼ëŸ¬ ì…ë‹ˆë‹¤.

- ìë°”ì˜ ì½”ë“œëŠ” ì¸í„°í”„ë¦¬í„°ë¡œ ì‹¤í–‰í•˜ë‹¤ê°€ ì ì ˆí•œ íƒ€ì´ë°ì—ëŠ” ì§ì ‘ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
- ë£¨í”„ë¥¼ëŒê±°ë‚˜, ìì£¼ í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œì˜ ê²½ìš°ì—ëŠ” JVMì´ ë‚´ë¶€ì ìœ¼ë¡œ ì»´íŒŒì¼ì„ í•´ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    
```java
// ë™ì‘ë°©ì‹

int x;
int y;
methodCall();
methodCall();
methodCall();

ì´ ìˆì„ë•Œ methodCall() ë©”ì†Œë“œëŠ” ë°˜ë³µì ìœ¼ë¡œ ë“±ì¥í•˜ê²Œ ë©ë‹ˆë‹¤.
```
    
1. JITëŠ” ë¨¼ì € ì „ì²´ ì†ŒìŠ¤ì½”ë“œë¥¼ í™•ì¸í•˜ë©° ì¤‘ë³µë˜ëŠ” ë¶€ë¶„ì´ ì–´ë””ê°€ ìˆëŠ”ì§€ í™•ì¸ì„ í•´ë‘¡ë‹ˆë‹¤.
2. ì¼ë‹¨ì€ ì¸í„°í”„ë¦¬í„° ë°©ì‹ìœ¼ë¡œ ì½ë‹¤ê°€ ì²«ë²ˆì§¸ methodCall()ì„ ë§Œë‚˜ëŠ”ìˆœê°„ ì´í›„ì— ì¤‘ë³µì´ ìˆëŠ”ê²ƒì„ ìºì¹˜í•©ë‹ˆë‹¤.
3. ì´í›„ methodCall() ë¶€ë¶„ì„ ì¸í„°í”„ë¦¬í„°ë¡œ ì²˜ë¦¬í•˜ì§€ì•Šê³ , ìºì‹±ëœ ê²°ê³¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    
### 2.3 GC (Gargabe Collection)
> gcë¥¼ ìˆ˜í–‰í•˜ëŠ” ëª¨ë“ˆì…ë‹ˆë‹¤.

- Execution ì•ˆì— ì†í•©ë‹ˆë‹¤.


---
    
## ğŸ“Œ Runtime Data Area (JVM Memory)

![image](https://user-images.githubusercontent.com/43930419/154240048-8574a027-bb15-480c-a527-8c4df19f5235.png)


### PC Register
> Threadê°€ **ì–´ë–¤ ë¶€ë¶„ì„ ì–´ë–¤ ëª…ë ¹**ìœ¼ë¡œ ì‹¤í–‰í•´ì•¼í• ì§€ë¥¼ ê¸°ë¡í•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.

- JVM ëª…ë ¹ì˜ ì£¼ì†Œë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
- Threadë³„ë¡œ ëª…ë ¹ì„ ë”°ë¡œ ê¸°ì–µí•´ì•¼ í•˜ë¯€ë¡œ, Threadê°€ ì‹œì‘ë ë•Œ ë§ˆë‹¤ ìƒì„±ë˜ê²Œ ë©ë‹ˆë‹¤.

### JVM Langauge Stacks (JVM Stack)
> ë©”ì†Œë“œ ë‚´ë¶€ì—ì„œ **ì ì‹œ ì‚´ì•„ìˆëŠ”** ë°ì´í„°ë“¤ì„ ì €ì¥í•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.

- ì„ì‹œë°ì´í„°, ë³€ìˆ˜, ìŠ¤ë ˆë“œ, ë©”ì†Œë“œì˜ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
- ë©”ì†Œë“œ í˜¸ì¶œë•Œë§ˆë‹¤ ê°ê°ì˜ ìŠ¤íƒ í”„ë ˆì„ì´ ìƒì„±ë˜ê³ , ë©”ì„œë“œ ìˆ˜í–‰ì´ ëë‚˜ë©´ ìˆœì°¨ì ìœ¼ë¡œ ì œê±°ë©ë‹ˆë‹¤.

### Native Method Stack 
> JAVAê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì–¸ì–´ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.

- ì¼ë°˜ì ì¸ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë„ì¤‘ì—ëŠ”, **JVM Stack**ì— ìŒ“ì´ë‹¤ê°€, í•´ë‹¹ ë©”ì†Œë“œ ë‚´ë¶€ì—ì„œ ë‹¤ë¥¸ì–¸ì–´ë¡œ ì‘ì„±ëœ ë©”ì†Œë“œê°€ ìˆë‹¤ë©´ í•´ë‹¹ ë©”ì†Œë“œëŠ” í•´ë‹¹ ì˜ì—­ì— ìŒ“ì´ê²Œ ë©ë‹ˆë‹¤.


### Method Area
> í´ë˜ìŠ¤ ì •ë³´ë¥¼ ì²˜ìŒ ë©”ëª¨ë¦¬ì— ì˜¬ë¦´ë•Œ **ì´ˆê¸°í™” ë˜ëŠ” ëŒ€ìƒ**ì„ ì €ì¥í•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.


> The method area is created on virtual machine start-up. Although the method area is logically part of the heap, [by oracle jvm spec docs](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.4)

- **ë…¼ë¦¬**ì ì¸ ê°œë…ì…ë‹ˆë‹¤. 
- í”„ë¡œê·¸ë¨ì„ êµ¬ì„±í•˜ëŠ” ë°”ì´íŠ¸ ì½”ë“œê°€ ì˜¬ë¼ê°€ê²Œ ë©ë‹ˆë‹¤
- í´ë˜ìŠ¤ì™€ ë©”ì†Œë“œ ë©”íƒ€ ë°ì´í„°ê°€ ì˜¬ë¼ê°€ëŠ” ê³µê°„ì…ë‹ˆë‹¤.
- Java7 ê¹Œì§€ëŠ” í´ë˜ìŠ¤ì™€ ë©”ì„œë“œ ë©”íƒ€ë°ì´í„°ë“¤ì„ **PermGen**ì— í• ë‹¹í–ˆì§€ë§Œ, **Java8** ì´í›„ë¶€í„°ëŠ” Native ì˜ì—­ìœ¼ë¡œ ì´ë™í•˜ì—¬ Metaspace ì˜ì—­ì— í• ë‹¹ë˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
- ì •ì  ë©”ì†Œë“œì™€ ì •ì  ë³€ìˆ˜ê°€ ì˜¬ë¼ê°€ê²Œ ë©ë‹ˆë‹¤.
  - Java7ê¹Œì§€ëŠ” **PermGen**ì— í• ë‹¹í–ˆì§€ë§Œ, **Java8** ì´í›„ë¶€í„°ëŠ” permGenì€ [ì‚¬ì´ì¦ˆ ì œí•œìœ¼ë¡œ ì¸í•œ ë¬¸ì œ](https://johngrib.github.io/wiki/java8-why-permgen-removed/)ë¡œ ì¸í•´ ì—†ì–´ì§€ê³ , **MetaSpace**ê°€ ë“±ì¥í•˜ê²Œ ë˜ì—ˆê³  ì •ì  ë©”ì†Œë“œ, ë³€ìˆ˜ë“¤ì€ **Heap**ì— í• ë‹¹ë˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.


### Java Heap
> newë¡œ ìƒì„±ë˜ëŠ” ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.  


- **Java** Heap ì€ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ `{New / Young} , {Old}` ë¶€ë¶„ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

- Java7 Permanent Java8 Metaspace ëŠ” Java Heap ì˜ì—­ì— ì†í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. :x:  
- Java7ì€ Permanent Heap, Java8ì€ Native Memory ì˜ì—­ì— ì†í•©ë‹ˆë‹¤.


#### Java7
![Untitled 1](https://user-images.githubusercontent.com/43930419/154238332-7b6fa208-cf3a-4c12-abf4-b6d391cf833a.png)
        


#### Java8
![image](https://user-images.githubusercontent.com/43930419/154243154-c83b4642-f7e9-44f4-bca6-8db05775f6f0.png)

- ê¸°ì¡´ê¹Œì§€ì˜ **Permanent** ì˜ì—­ì—ëŠ” Classì˜ Meta Data, Methodì˜ MeteData, Static Object ë³€ìˆ˜, ìƒìˆ˜, JVM JIT ê´€ë ¨ ë°ì´í„° ë“±ì´ ì €ì¥ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤.
- **Java8** ë¶€í„°ëŠ” í•´ë‹¹ì˜ì—­ì„ **MetaSpace**ë¡œ ëª…ì¹­ì„ ë³€ê²½í•˜ê³ , JVMì´ ì•„ë‹Œ **OSê°€ ê´€ë¦¬í•˜ë„ë¡ ë³€ê²½**ë˜ì–´ ê¸°ì¡´ê¹Œì§€ JVMì— ì˜í•´ì„œ í¬ê¸°ê°€ ê°•ì œë˜ë˜ ë©”ëª¨ë¦¬ ì‚¬ì´ì¦ˆì— ì—¬ìœ ê°€ ìƒê¸°ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.


---

## Conclusion
- JVMì€ JAVAì™€ OSì‚¬ì´ì—ì„œ **ì¤‘ê°œì** ì—­í• ì„ ìˆ˜í–‰í•´, OSì— êµ¬ì• ë°›ì§€ ì•Šê³  ìë°” ì½”ë“œë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œí•´ì£¼ë©°, **ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬**í•˜ëŠ” ë¨¸ì‹ ì„ ì´ì•¼ê¸°í•©ë‹ˆë‹¤.
- JVMì€ í¬ê²Œ **Class Loader**, **Execution Engine**, **Runtime Data Area** ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.
- Execution EngineëŠ” **Interpreter**, **JIT**, **GC** ë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤.
- Runtime Data AreaëŠ” Thread ë³„ë¡œ **ë¶„ë¦¬ë˜ëŠ” ì˜ì—­**ê³¼, Threadê°„ ì—ë„ ê³µìœ ë˜ëŠ” ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.
- **Java8** ë¶€í„°ëŠ” pemgenì´ ì‚¬ë¼ì§€ê³ , **metaspace**ë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.



---

## Reference

- [Oracle JVM docs java8](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html)  
- [Oracle GC docs](https://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/index.html)
- [Where are static methods and static variables stored in Java?](https://stackoverflow.com/a/8388068/11355002)
- [JIT ì»´íŒŒì¼ - ìœ„í‚¤ë°±ê³¼, ìš°ë¦¬ ëª¨ë‘ì˜ ë°±ê³¼ì‚¬ì „](https://ko.wikipedia.org/wiki/JIT_%EC%BB%B4%ED%8C%8C%EC%9D%BC)
- [java JIT ì»´íŒŒì¼ëŸ¬ë€?](https://coding-nyan.tistory.com/85)
- [#ìë°”ê°€ìƒë¨¸ì‹ , JVM(Java Virtual Machine)ì´ë€ ë¬´ì—‡ì¸ê°€?](https://=asfirstalways.tistory.com/158)
- [https://jdm.kr/blog/188](https://jdm.kr/blog/188)
- [https://jithub.tistory.com/40](https://jithub.tistory.com/40)
- [ê¸°ê³„ì¸ê°„ë‹˜ ë¸”ë¡œê·¸](https://johngrib.github.io/wiki/java8-why-permgen-removed/)

